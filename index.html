<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>‡πÅ‡∏à‡πâ‡∏á‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (v2.1.5)</title>
  
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap');
    body { font-family: 'Sarabun', sans-serif; }
    
    .loading-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(255,255,255,0.98); z-index: 9999;
      display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px;
    }
    .spinner {
      border: 4px solid #f3f3f3; border-top: 4px solid #16a34a; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 20px;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .session-card.selected { border-color: #ef4444; background-color: #fef2f2; }
    .session-card.disabled { opacity: 0.7; background-color: #f3f4f6; pointer-events: none; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen pb-20">

  <!-- DIAGNOSTIC SCRIPT (Fail-Safe) -->
  <script>
    window.startTime = Date.now();
    console.log("Basic JS Block started");
    document.addEventListener("DOMContentLoaded", function() {
        // If the main script hasn't taken over by now, shout about it.
        const st = document.getElementById('status-text');
        if(st && st.innerText.includes('Waiting')) {
             st.innerHTML += "<br>[Diagnostic] DOM Loaded but Main Script didn't run.";
        }
    });
  </script>

  <!-- Loading -->
  <div id="loading" class="loading-overlay">
    <div class="spinner"></div>
    <p class="font-bold text-gray-700">System Loading (v2.2.0)...</p>
    <p id="status-text" class="text-sm text-gray-500 mt-2">Waiting for JS...</p>
  </div>

  <div id="main-container" class="max-w-md mx-auto bg-white min-h-screen shadow-xl relative hidden">
    <!-- Header -->
    <div class="bg-green-600 p-6 rounded-b-3xl text-white shadow-lg">
      <div class="flex justify-between items-center">
        <div>
          <h1 class="text-xl font-bold">‡πÅ‡∏à‡πâ‡∏á‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</h1>
          <p class="text-green-100 text-xs mt-1">Braincloud Operations</p>
        </div>
        <div class="text-center">
           <img id="userPic" src="https://via.placeholder.com/40" class="w-12 h-12 rounded-full border-2 border-white shadow-sm mx-auto bg-gray-200">
           <p id="userNameDisplay" class="text-xs font-bold mt-1 text-white">Guest</p>
        </div>
      </div>
    </div>

    <!-- Form -->
    <form id="mainForm" class="p-5 space-y-6">
      <!-- 1. School -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">üè´ ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
        <select id="schoolSelect" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 bg-gray-50" onchange="checkScheduleCondition()">
          <option value="" disabled selected>-- ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ --</option>
        </select>
      </div>

      <!-- 2. Date -->
      <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
        <div class="flex justify-between items-center mb-2">
          <label class="block text-sm font-semibold text-gray-700">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
          <label class="flex items-center space-x-2 text-xs text-gray-500">
            <input type="checkbox" id="multiDayCheck" class="rounded text-green-600" onchange="toggleEndDate()">
            <span>‡∏´‡∏¢‡∏∏‡∏î‡∏´‡∏•‡∏≤‡∏¢‡∏ß‡∏±‡∏ô?</span>
          </label>
        </div>
        <div class="grid grid-cols-2 gap-2">
          <div class="col-span-2">
            <span class="text-xs text-gray-500 ml-1">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</span>
            <input type="date" id="startDate" class="w-full p-2 border border-gray-300 rounded-lg" onchange="handleDateChange()">
          </div>
          <div id="endDateContainer" class="col-span-2 hidden">
             <span class="text-xs text-gray-500 ml-1">‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</span>
             <input type="date" id="endDate" class="w-full p-2 border border-gray-300 rounded-lg">
          </div>
        </div>
      </div>

      <!-- 3. Schedule -->
      <div id="scheduleSection" class="hidden">
        <div class="flex justify-between items-center mb-2">
          <h3 class="font-bold text-gray-800">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
          <span class="text-xs text-gray-500">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≤‡∏ö‡∏ó‡∏µ‡πà‡∏á‡∏î</span>
        </div>
        <div id="loadingSchedule" class="text-center py-4 hidden"><i class="fas fa-circle-notch fa-spin text-green-500"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á...</div>
        <div id="scheduleList" class="space-y-2"></div>
        <div id="noScheduleMsg" class="hidden text-center py-4 text-gray-400 text-sm bg-gray-50 rounded-lg border border-dashed">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
      </div>

      <!-- 4. Manual Type -->
      <div id="manualTypeSection">
        <label class="block text-sm font-semibold text-gray-700 mb-2">‚è∞ ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏´‡∏¢‡∏∏‡∏î</label>
        <div class="grid grid-cols-2 gap-3">
          <label class="cursor-pointer">
            <input type="radio" name="periodType" value="Whole Day" class="peer sr-only" checked>
            <div class="p-3 text-center border rounded-lg peer-checked:bg-green-100 peer-checked:border-green-500 peer-checked:text-green-700 transition-all">‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô</div>
          </label>
          <label class="cursor-pointer">
            <input type="radio" name="periodType" value="Partial" class="peer sr-only">
            <div class="p-3 text-center border rounded-lg peer-checked:bg-yellow-100 peer-checked:border-yellow-500 peer-checked:text-yellow-700 transition-all">‡∏ö‡∏≤‡∏á‡∏Ñ‡∏≤‡∏ö (‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏á)</div>
          </label>
        </div>
      </div>

      <!-- 5. Reason -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">üìù ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏ / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
        <textarea id="reason" rows="3" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡πá‡∏Å, ‡∏ô‡πâ‡∏≥‡∏ó‡πà‡∏ß‡∏°, ‡∏Ñ‡∏£‡∏π‡∏õ‡πà‡∏ß‡∏¢"></textarea>
      </div>

      <!-- Submit -->
      <button type="button" onclick="submitData()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl shadow-lg transition-transform transform active:scale-95 flex justify-center items-center">
        <span>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span><i class="fas fa-arrow-right ml-2"></i>
      </button>
    </form>
  </div>

  <!-- Separate JS File -->
  <script src="app.js?v=2"></script>
</body>
</html>
</body>
</html>
