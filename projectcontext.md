ðŸ“˜ Project Context & Database Schema
Project Name: Braincloud Operations System (School Holiday & Timeline) Platform: Google Apps Script (GAS) + Google Sheets

1. System Architecture
Frontend: GitHub Pages (HTML/JS/Tailwind) hosting dashboard.html and index.html (LIFF).

Backend: Google Apps Script (Code.gs) acting as API (doGet, doPost).

Database: Google Sheets (accessed via SpreadsheetApp).

2. Core Databases (Google Sheets)
ðŸ“‚ File: [bc]_central_db.xlsx
Primary database for school operations.

Key Sheets & Columns:

dim_school (School Master Data)
Stores list of all schools and their status.

school_id (e.g., sc-00001)

school_code (e.g., BDB) - Primary Key for display

school_name_en

school_name_th

status (active/inactive) - Filter by 'active' only.

dim_user (Teacher/Staff Master Data)
Stores teacher profiles.

user_id (e.g., bcp-00001)

firstname_en, lastname_en

nickname_en

user_type (Code: 210=Full-time, 220=Part-time, 100=External)

status (enabled/disabled)

fact_daily_session (Teaching Schedule)
Stores every single class session. Huge table.

session_id (Unique ID)

date (YYYY-MM-DD)

start_time, end_time (HH:mm:ss)

class_name (e.g., G.1/1)

school_id (Foreign Key -> dim_school)

actual_teacher_id (Who actually taught)

original_teacher_id (Who was supposed to teach)

status (Normal, Substituted, Cancelled, etc.)

fact_teacher_unavailability (Absence Records)
Stores leave records for teachers.

unavailability_id

teacher_id (Foreign Key -> dim_user)

start_date, end_date

start_time, end_time

remark (Reason for leave)

view_school_coordinator (Coordinator Mapping)
Maps schools to their responsible coordinators.

School Name (Key)

Coordinator Name

cache_today_session (Generated by Script)
A helper sheet generated daily to speed up read operations.

session_id, school_code, class_name, time_slot, teacher_name, teacher_type, status

ðŸ“‚ File: [bc]_holidays.xlsx
Secondary database for logging holiday requests.

Holiday_Log
Stores holiday/cancellation requests from LIFF App.

Ticket ID

Timestamp

User (Reporter)

School

Start Date, End Date

Type (Whole Day / Specific Sessions)

Session IDs

Reason

Status

3. Important Logic / Business Rules
Teacher Type:

Full-time = user_type 210

Part-time = user_type 220

Cover/Substitution:

Identified when actual_teacher_id != original_teacher_id in fact_daily_session.

Cancellation:

Identified by status column in fact_daily_session starting with "Cancelled".

Timezone:

All scripts must force Asia/Bangkok timezone to avoid date shifting issues.

Time formatting must handle raw string parsing if getValues() returns varying formats.

4. Coding Conventions (GAS)
Use SpreadsheetApp.openById(ID) to access files.

Use LockService for write operations to prevent race conditions.

Prefer getDisplayValues() for Time columns to avoid 1899-epoch date issues.